# Allkaset Price Scraper

Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å [allkaset.com](https://www.allkaset.com/‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏±‡∏Å.php)

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á

- **‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**: ‡∏ï‡∏•‡∏≤‡∏î‡πÑ‡∏ó, ‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏µ‡πà‡∏°‡∏∏‡∏°‡πÄ‡∏°‡∏∑‡∏≠‡∏á, ‡∏ï‡∏•‡∏≤‡∏î‡∏®‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡∏≠‡∏á
- **‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤**: ‡∏ú‡∏±‡∏Å/‡∏ú‡∏•‡πÑ‡∏°‡πâ 80+ ‡∏ä‡∏ô‡∏¥‡∏î
- **‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏õ‡∏µ 2020

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏£‡∏±‡∏ô Scraper ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°
```bash
npm run scrape:allkaset
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Dry Run)
‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡πÅ‡∏ï‡πà**‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á database**
```bash
npm run scrape:allkaset -- --dry-run
```

### ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÇ‡∏î‡∏¢‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ N ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏£‡∏Å
```bash
npm run scrape:allkaset -- --dry-run --limit=5
```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Output

```
üåæ Allkaset Price Scraper
========================

üì¶ Ensuring products exist in database...
  Total products: 111

üì• Scraping historical prices...
  Fetching ‡∏ú‡∏±‡∏Å‡∏ä‡∏µ (pk=4203)...
    Found 132 price records
  Fetching ‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡∏¢‡∏≤‡∏ß (pk=4204)...
    Found 132 price records

üìä Total records scraped: 5552

üíæ Saving to database...
    Inserted 500/5552 records
    ...

‚úÖ Scraping completed!
   Products processed: 80
   Records inserted: 5552
```

## Database Schema

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á `market_prices`:

| Column | Description |
|--------|-------------|
| productId | ID ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ |
| sourceName | ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î (‡∏ï‡∏•‡∏≤‡∏î‡πÑ‡∏ó, ‡∏™‡∏µ‡πà‡∏°‡∏∏‡∏°‡πÄ‡∏°‡∏∑‡∏≠‡∏á, ‡∏®‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡∏≠‡∏á) |
| priceMin | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î |
| priceMax | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î |
| dateRecorded | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ |

## ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `scripts/scrape-allkaset.ts` ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô `ALLKASET_PRODUCTS`:

```typescript
const ALLKASET_PRODUCTS = {
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ pk ‡∏à‡∏≤‡∏Å URL ‡∏Ç‡∏≠‡∏á allkaset.com
  // URL pattern: allkaset.com/‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á.php?pk=XXXX
  4999: { name: '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', category: ProductCategory.CROP },
};
```

## Rate Limiting

Script ‡∏°‡∏µ delay 500ms ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ overload server
